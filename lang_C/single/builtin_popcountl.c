#include <assert.h>

static int __attribute__((noinline)) popcountl(unsigned long x)
{
	return __builtin_popcountl(x);
}

int main(void)
{
#define ASSERTPOPCOUNTL(val, result) \
	assert(__builtin_popcountl(val) == result); \
	assert(popcountl(val) == result);

	ASSERTPOPCOUNTL(0x00000000UL, 0);
	ASSERTPOPCOUNTL(0x00000001UL, 1);
	ASSERTPOPCOUNTL(0x00003000UL, 2);
	ASSERTPOPCOUNTL(0x00000031UL, 3);
	ASSERTPOPCOUNTL(0x00002222UL, 4);
	ASSERTPOPCOUNTL(0x00001055UL, 5);
	ASSERTPOPCOUNTL(0x00006116UL, 6);
	ASSERTPOPCOUNTL(0x00007107UL, 7);
	ASSERTPOPCOUNTL(0x00008778UL, 8);
	ASSERTPOPCOUNTL(0x00007999UL, 9);
	ASSERTPOPCOUNTL(0x0000FFA0UL, 10);
	ASSERTPOPCOUNTL(0x00007FCCUL, 11);
	ASSERTPOPCOUNTL(0x0000CFFCUL, 12);
	ASSERTPOPCOUNTL(0x00007CFFUL, 13);
	ASSERTPOPCOUNTL(0x00007FFEUL, 14);
	ASSERTPOPCOUNTL(0x0000F7FFUL, 15);
	ASSERTPOPCOUNTL(0x0000FFFFUL, 16);
	ASSERTPOPCOUNTL(0xFFFF0001UL, 17);
	ASSERTPOPCOUNTL(0xFFFF3000UL, 18);
	ASSERTPOPCOUNTL(0xFFFF0031UL, 19);
	ASSERTPOPCOUNTL(0xFFFF2222UL, 20);
	ASSERTPOPCOUNTL(0xFFFF1055UL, 21);
	ASSERTPOPCOUNTL(0xFFFF6116UL, 22);
	ASSERTPOPCOUNTL(0xFFFF7107UL, 23);
	ASSERTPOPCOUNTL(0xFFFF8778UL, 24);
	ASSERTPOPCOUNTL(0x7999FFFFUL, 25);
	ASSERTPOPCOUNTL(0xFFA0FFFFUL, 26);
	ASSERTPOPCOUNTL(0x7FCCFFFFUL, 27);
	ASSERTPOPCOUNTL(0xCFFCFFFFUL, 28);
	ASSERTPOPCOUNTL(0x7CFFFFFFUL, 29);
	ASSERTPOPCOUNTL(0x7FFEFFFFUL, 30);
	ASSERTPOPCOUNTL(0xF7FFFFFFUL, 31);
	ASSERTPOPCOUNTL(0xFFFFFFFFUL, 32);
	ASSERTPOPCOUNTL((unsigned long)-1, sizeof(unsigned long)*8);
	return 0;
}
